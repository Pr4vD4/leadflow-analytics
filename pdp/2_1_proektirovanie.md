# 2.1. Проектирование модели программного продукта

## Назначение и сферы применения разрабатываемого продукта

Система LeadFlow Analytics предназначена для автоматизации сбора, анализа и обработки клиентских заявок с использованием искусственного интеллекта. Основные сферы применения системы:

1. **Digital-агентства и веб-студии**
   - Сбор заявок с сайтов клиентов
   - Анализ эффективности рекламных кампаний
   - Управление клиентскими запросами

2. **Отделы продаж компаний**
   - Централизованное хранение всех входящих обращений
   - Приоритизация заявок на основе ИИ-анализа
   - Автоматизация рутинных операций

3. **Маркетинговые подразделения**
   - Аналитика источников заявок
   - Оценка конверсии по различным каналам
   - Оптимизация маркетинговых активностей

4. **Службы поддержки клиентов**
   - Структурирование обращений клиентов
   - Автоматизация генерации ответов
   - Отслеживание статусов обработки заявок

## Сбор, обработка и анализ информации для проектирования

### Методы сбора информации

В процессе проектирования системы LeadFlow Analytics были использованы следующие методы сбора информации:

1. **Интервью с сотрудниками компании**
   - Проведено 8 интервью с менеджерами, маркетологами и руководителями отделов
   - Выявлены основные проблемы в текущих процессах
   - Определены ключевые требования к новой системе

2. **Анализ существующих бизнес-процессов**
   - Изучение текущего процесса обработки заявок
   - Выявление узких мест и неэффективных этапов
   - Определение возможностей для автоматизации

3. **Бенчмаркинг конкурентных решений**
   - Анализ функциональности существующих CRM-систем
   - Изучение решений для интеграции с Bitrix24
   - Обзор систем с использованием ИИ для обработки данных

4. **Анализ технической документации**
   - Изучение API Bitrix24, OpenAI, Telegram
   - Анализ документации Laravel и других технологий
   - Оценка технических ограничений и возможностей

### Результаты анализа

На основе собранной информации были сделаны следующие выводы:

1. **Ключевые проблемы**
   - Большая часть времени менеджеров тратится на ручную обработку заявок
   - Отсутствует единая система для хранения и анализа данных
   - Нет автоматической классификации и приоритизации заявок

2. **Потребности пользователей**
   - Менеджеры: быстрый доступ к информации, автоматизация рутинных задач
   - Руководители: аналитика и отчетность, контроль эффективности
   - Маркетологи: анализ источников заявок, данные для оптимизации кампаний

3. **Технические требования**
   - Возможность интеграции с существующими системами
   - Высокая производительность при работе с большим объемом данных
   - Защита персональных данных клиентов

## Требования к модулям программного продукта

### 1. Интеграционный модуль

**Назначение**: Обеспечение сбора заявок с сайтов клиентов через REST API.

**Функциональные требования**:

- Предоставление REST API для приема заявок в формате JSON
- Поддержка аутентификации через API-ключ
- Валидация входящих данных
- Асинхронная обработка заявок при высокой нагрузке

**Нефункциональные требования**:

- Время ответа API не более 300 мс
- Обработка до 100 запросов в секунду
- Защита от DDoS-атак и злоупотреблений API

### 2. Мини-CRM модуль

**Назначение**: Управление заявками и рабочими процессами.

**Функциональные требования**:

- Просмотр, редактирование и удаление заявок
- Управление статусами заявок (новая, в работе, завершена и т.д.)
- Тегирование заявок для удобного поиска
- Загрузка и хранение файлов, связанных с заявками
- Отправка уведомлений в Telegram при изменении статуса

**Нефункциональные требования**:

- Интуитивно понятный интерфейс
- Время загрузки страницы не более 2 секунд
- Поддержка до 50 одновременных пользователей
- Разграничение доступа между компаниями (мультитенантность)

### 3. ИИ-аналитика модуль

**Назначение**: Автоматизация обработки заявок с использованием искусственного интеллекта.

**Функциональные требования**:

- Автоматическая категоризация заявок по типу (жалоба, запрос, предложение)
- Суммаризация текста заявки для быстрого ознакомления
- Генерация рекомендуемых ответов на типовые запросы
- Оценка релевантности заявки по 10-балльной шкале

**Нефункциональные требования**:

- Время обработки заявки ИИ не более 5 секунд
- Точность категоризации не менее 85%
- Асинхронная обработка через очереди
- Возможность переобучения моделей

### 4. Дашборд аналитики модуль

**Назначение**: Визуализация метрик и статистики по заявкам.

**Функциональные требования**:

- Отображение общего количества заявок за период
- Визуализация конверсии и распределения по источникам
- Фильтрация данных по дате, статусу, тегам
- Экспорт данных в CSV-формат
- Отображение средней оценки релевантности заявок

**Нефункциональные требования**:

- Время загрузки графиков не более 3 секунд
- Интерактивный интерфейс с возможностью настройки
- Адаптивная верстка для мобильных устройств
- Автоматическое обновление данных каждые 5 минут

### 5. Интеграция с Bitrix24 модуль

**Назначение**: Обеспечение синхронизации данных с CRM-системой Bitrix24.

**Функциональные требования**:

- Отправка заявок в Bitrix24 через REST API
- Обновление статусов заявок при изменении в Bitrix24
- Настройка маппинга полей между системами
- Ручная и автоматическая синхронизация

**Нефункциональные требования**:

- Минимальная задержка при синхронизации (не более 1 минуты)
- Устойчивость к сбоям в работе Bitrix24 API
- Логирование всех операций синхронизации
- Возможность отката изменений при ошибках

## Проектирование пользовательского интерфейса

### Основные принципы дизайна

При проектировании пользовательского интерфейса LeadFlow Analytics были применены следующие принципы:

1. **Простота и интуитивность**
   - Минимализм в дизайне
   - Понятные и узнаваемые иконки
   - Логичная структура навигации

2. **Информативность**
   - Четкое отображение статусов заявок
   - Визуальное выделение приоритетных элементов
   - Информативные подсказки и уведомления

3. **Адаптивность**
   - Корректное отображение на различных устройствах
   - Оптимизация для мобильных телефонов и планшетов
   - Динамическое изменение интерфейса в зависимости от разрешения экрана

4. **Согласованность**
   - Единый стиль всех элементов интерфейса
   - Последовательное расположение информации
   - Стандартизированные компоненты и паттерны

### Структура пользовательского интерфейса

Интерфейс системы включает следующие основные экраны:

1. **Панель управления (Дашборд)**
   - Краткая статистика (количество заявок, конверсия)
   - Графики распределения заявок по источникам
   - Карточки с ключевыми метриками

2. **Список заявок**
   - Таблица с фильтрацией и сортировкой
   - Цветовая индикация статусов
   - Быстрые действия (просмотр, редактирование, удаление)

3. **Карточка заявки**
   - Подробная информация о заявке
   - Панель управления статусом и тегами
   - Секция прикрепленных файлов
   - Блок с ИИ-анализом (категория, суммаризация, рекомендуемый ответ)

4. **Настройки интеграции**
   - Форма настройки API-ключей
   - Конфигурация интеграции с Bitrix24
   - Настройка уведомлений в Telegram

5. **Страница аналитики**
   - Расширенные графики и диаграммы
   - Фильтры для анализа данных
   - Экспорт отчетов

## Проектирование базы данных

### Концептуальная модель данных

Проектирование базы данных начиналось с создания концептуальной модели, отражающей основные сущности системы и связи между ними:

1. **Компания** (Company) - юридическое лицо, использующее систему
2. **Заявка** (Lead) - обращение клиента
3. **Статус заявки** (LeadStatus) - текущее состояние заявки
4. **Тег** (LeadTag) - метка для классификации заявки
5. **Файл** (File) - прикрепленный к заявке документ или изображение
6. **Интеграция с Bitrix24** (Bitrix24Integration) - настройки синхронизации с Bitrix24

### Логическая модель базы данных

На основе концептуальной модели была разработана логическая модель базы данных, включающая следующие основные таблицы:

1. **companies**
   - `id` - Первичный ключ
   - `name` - Название компании
   - `api_key` - API-ключ для интеграции
   - `settings` - JSON с настройками

2. **leads**
   - `id` - Первичный ключ
   - `company_id` - Внешний ключ к таблице companies
   - `source` - Источник заявки
   - `name` - Имя клиента
   - `phone` - Телефон
   - `email` - Email
   - `message` - Текст заявки
   - `status_id` - Внешний ключ к таблице lead_statuses
   - `custom_fields` - JSON с дополнительными полями
   - `category` - Категория (авто-определение ИИ)
   - `summary` - Краткое описание (авто-генерация ИИ)
   - `relevance_score` - Оценка релевантности (1-10)
   - `created_at` - Дата создания
   - `updated_at` - Дата обновления

3. **lead_statuses**
   - `id` - Первичный ключ
   - `name` - Название статуса
   - `color` - Цвет для отображения в интерфейсе
   - `is_final` - Признак финального статуса

4. **lead_tags**
   - `id` - Первичный ключ
   - `name` - Название тега
   - `color` - Цвет для отображения

5. **lead_tag_pivot**
   - `lead_id` - ID заявки
   - `tag_id` - ID тега

6. **files**
   - `id` - Первичный ключ
   - `lead_id` - Внешний ключ к таблице leads
   - `company_id` - Внешний ключ к таблице companies
   - `path` - Путь к файлу
   - `original_name` - Оригинальное имя файла
   - `mime_type` - MIME тип файла
   - `size` - Размер в байтах

7. **bitrix24_integrations**
   - `id` - Первичный ключ
   - `company_id` - Внешний ключ к таблице companies
   - `webhook_url` - URL для вебхука
   - `access_token` - Токен доступа
   - `refresh_token` - Токен для обновления
   - `settings` - JSON с настройками маппинга полей

### Схема связей

Между таблицами базы данных установлены следующие связи:

- `companies` 1:N `leads` (одна компания имеет множество заявок)
- `companies` 1:N `files` (одна компания имеет множество файлов)
- `companies` 1:1 `bitrix24_integrations` (одна компания имеет одну интеграцию с Bitrix24)
- `leads` N:M `lead_tags` через `lead_tag_pivot` (заявка может иметь несколько тегов, тег может быть присвоен нескольким заявкам)
- `leads` 1:N `files` (одна заявка может иметь несколько прикрепленных файлов)
- `lead_statuses` 1:N `leads` (один статус может быть присвоен множеству заявок)

Данная структура базы данных обеспечивает эффективное хранение и доступ к информации, необходимой для работы системы LeadFlow Analytics, а также поддерживает мультитенантную архитектуру через разделение данных по company_id.
